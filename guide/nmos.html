<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MMAM HOW TO USE - nmos">
    <title>MMAM Guide / nmos</title>
    <link rel="icon" type="image/svg+xml" href="../images/favicon.svg">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 text-slate-900 font-sans" data-guide-page="nmos">
    <div class="lg:flex">

<aside id="guide-sidebar" class="bg-slate-900 text-white w-72 min-h-screen flex flex-col fixed inset-y-0 left-0 z-40 transform transition-transform duration-200 lg:translate-x-0 -translate-x-full">
    <div class="px-6 py-5 border-b border-white/10 flex items-center gap-3">
        <svg width="40" height="40" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" class="flex-shrink-0">
            <rect x="4" y="4" width="56" height="56" rx="14" fill="#1e293b"/>
            <g fill="none" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="32" cy="28" r="8" stroke="#60a5fa" stroke-width="3"/>
                <path d="M20 44 A16 16 0 0 1 44 44" stroke="#3b82f6" stroke-width="3"/>
                <circle cx="20" cy="44" r="4" fill="#1e293b" stroke="#60a5fa" stroke-width="3"/>
                <circle cx="32" cy="44" r="4" fill="#1e293b" stroke="#60a5fa" stroke-width="3"/>
                <circle cx="44" cy="44" r="4" fill="#1e293b" stroke="#60a5fa" stroke-width="3"/>
            </g>
        </svg>
        <div>
            <p class="text-xs uppercase tracking-[0.3em] text-slate-300">HOW TO USE</p>
            <h1 class="text-xl font-semibold">MMAM Guide</h1>
        </div>
    </div>
    <nav class="flex-1 px-4 py-6 overflow-y-auto text-sm space-y-1">
        <a href="index.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="overview">概要</a>
        <a href="stack.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="stack">スタック構成</a>
        <a href="setup.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="setup">セットアップ＆コンフィグレーション</a>
        <a href="dashboard.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="dashboard">Dashboard / ダッシュボード</a>
        <a href="flows.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="flows">Flows / フロー一覧</a>
        <a href="search.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="search">Search / 検索</a>
        <a href="new-flow.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="new-flow">New Flow / 新規フロー</a>
        <a href="nmos.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="nmos">NMOS Wizard / インポート</a>
        <a href="planner.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="planner">Planner / プランナー</a>
        <a href="checker.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="checker">Checker / チェック</a>
        <a href="users.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="users">Users / ユーザー管理</a>
        <a href="settings.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="settings">Settings / 設定</a>
        <a href="usecases.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="usecases">ユースケース</a>
        <a href="api.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="api">REST APIまとめ</a>
    </nav>
    <div class="px-4 py-4 border-t border-white/10 space-y-3 text-xs">
        <a href="../index.html" class="block bg-white/10 rounded px-3 py-2 text-center">トップページへ</a>
    </div>
</aside>

        <div class="flex-1 lg:ml-72 min-h-screen bg-slate-50">
            <header class="sticky top-0 z-30 bg-slate-50/95 backdrop-blur border-b border-slate-200 flex items-center justify-between px-4 py-3 lg:hidden">
                <button id="guide-sidebar-toggle" class="px-3 py-2 rounded border border-slate-300 text-sm font-medium">メニュー</button>
                <a href="../index.html" class="text-sm text-slate-500 underline">トップページ</a>
            </header>
            <main class="px-6 py-10 max-w-5xl mx-auto space-y-12">

<section class="bg-gradient-to-r from-purple-900 via-slate-900 to-purple-700 rounded-3xl text-white p-8 shadow-xl border border-purple-900 space-y-4">
    <div>
        <p class="text-xs uppercase tracking-[0.6em] text-white/60">nmos</p>
        <h2 class="text-3xl font-semibold">NMOS 連携のワークフロー</h2>
        <p class="text-white/80">IS-04/IS-05 に不慣れな方でも、Wizard の画面に沿って進めるだけで NMOS デバイスとの設定差分を確認し、必要なフィールドを MMAM 側へ取り込めます。</p>
    </div>
    <div class="flex flex-wrap gap-3">
        <a href="../index.html" class="px-4 py-2 rounded-full bg-white text-slate-900 font-semibold text-sm shadow">トップページへ</a>
        <a href="https://specs.amwa.tv/is-04/releases/v1.3.1/" target="_blank" class="px-4 py-2 rounded-full border border-white/30 text-sm">AMWA IS-04 Spec</a>
    </div>
</section>

<section class="bg-white rounded-2xl shadow-sm border border-slate-200 p-8 space-y-6">
    <h3 class="text-2xl font-semibold">UI Wizard での操作手順</h3>
    <p class="text-slate-700 leading-relaxed">
        NMOS 連携は、UI の Wizard 画面から4つのステップで完了します。
    </p>
    <ol class="list-decimal ml-5 text-slate-700 space-y-3">
        <li>
            <strong>Discover（デバイス探索）</strong><br>
            <span class="text-sm text-slate-600">NMOS ノードのベース URL と API バージョン（IS-04/IS-05）を入力してデバイスを探索します。検出されたノード一覧が表示されます。</span>
        </li>
        <li>
            <strong>Select Devices（デバイス選択）</strong><br>
            <span class="text-sm text-slate-600">Flow と紐付けたい Sender/Receiver をチェックします。既存の Flow がある場合は自動的にマッピングされます。</span>
        </li>
        <li>
            <strong>Diff（差分確認）</strong><br>
            <span class="text-sm text-slate-600">IS-05 の transport_params と MMAM 側の Flow 定義を比較し、差分を色付きで表示します。適用前に変更内容を確認できます。</span>
        </li>
        <li>
            <strong>Apply（MMAMへ取り込み）</strong><br>
            <span class="text-sm text-slate-600">差分を選択して MMAM の Flow フィールドへ反映します。NMOS デバイス側には変更を加えず、常に Pull（取り込み）のみです。</span>
        </li>
    </ol>
    <p class="text-sm text-slate-500 mt-4">各ステップは視覚的に分かりやすく表示され、いつでも前のステップに戻ることができます。</p>
</section>

<section class="bg-white rounded-2xl shadow-sm border border-slate-200 p-8 space-y-6">
    <h3 class="text-2xl font-semibold">NMOS API の使い方</h3>
    <p class="text-slate-700 leading-relaxed">
        REST API を使って NMOS 連携を自動化することもできます。
    </p>

    <div class="bg-slate-50 border border-slate-200 rounded-xl p-6 space-y-4">
        <h4 class="font-semibold text-lg">ステップ1: NMOS ノードを探索</h4>
        <p class="text-sm text-slate-600">NMOS ノードのベース URL を指定してデバイス情報を取得します。</p>
        <pre class="bg-slate-900 text-white text-xs rounded-xl p-4 overflow-x-auto"><code>curl -X POST https://localhost:8443/api/nmos/discover \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "base_url": "http://192.168.1.100:3000",
    "version": "v1.3"
  }'</code></pre>
        <p class="text-xs text-slate-500 mt-2">→ 検出された Node、Sender、Receiver の一覧が返ってきます。</p>
    </div>

    <div class="bg-slate-50 border border-slate-200 rounded-xl p-6 space-y-4">
        <h4 class="font-semibold text-lg">ステップ2: Flow と NMOS の差分を確認</h4>
        <p class="text-sm text-slate-600">既存の Flow と NMOS デバイスの設定を比較します。</p>
        <pre class="bg-slate-900 text-white text-xs rounded-xl p-4 overflow-x-auto"><code>curl -H "Authorization: Bearer YOUR_TOKEN" \
  https://localhost:8443/api/flows/f1a2b3c4-d5e6-47a8-b9c0-d1e2f3a4b5c6/nmos/check</code></pre>
        <p class="text-xs text-slate-500 mt-2">→ transport_params の差分が JSON で返ってきます。</p>
    </div>

    <div class="bg-slate-50 border border-slate-200 rounded-xl p-6 space-y-4">
        <h4 class="font-semibold text-lg">ステップ3: MMAM に取り込む</h4>
        <p class="text-sm text-slate-600">差分を確認したうえで、NMOS 側の値を MMAM の Flow レコードにコピーします。</p>
        <pre class="bg-slate-900 text-white text-xs rounded-xl p-4 overflow-x-auto"><code>curl -X POST https://localhost:8443/api/flows/f1a2b3c4-d5e6-47a8-b9c0-d1e2f3a4b5c6/nmos/apply \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "fields": ["source_addr_a", "multicast_addr_a", "alias1"]
  }'</code></pre>
        <p class="text-xs text-slate-500 mt-2">→ 選択したフィールドだけが MMAM に更新され、NMOS デバイスへは書き込みません。</p>
    </div>
</section>

<section class="grid md:grid-cols-2 gap-6">
    <article class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 space-y-3">
        <h3 class="text-xl font-semibold">NMOS について</h3>
        <p class="text-sm text-slate-600">NMOS（Networked Media Open Specifications）は、AMWA が策定した IP メディアネットワークの標準規格です。</p>
        <ul class="list-disc ml-5 text-xs text-slate-600 space-y-1">
            <li><strong>IS-04</strong>: デバイスの Discovery と Registration</li>
            <li><strong>IS-05</strong>: Connection Management（接続制御）</li>
            <li><strong>IS-08</strong>: Channel Mapping（チャンネルマッピング）</li>
            <li><strong>IS-09</strong>: System Parameters（システムパラメータ）</li>
        </ul>
    </article>
    <article class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 space-y-3">
        <h3 class="text-xl font-semibold">トラブルシューティング</h3>
        <ul class="list-disc ml-5 text-sm text-slate-600 space-y-1">
            <li><strong>SSL エラー</strong> — <code>NMOS_TLS_VERIFY=false</code> で証明書検証を無効化（開発環境のみ）</li>
            <li><strong>タイムアウト</strong> — NMOS ノードの URL とネットワーク疎通を確認</li>
            <li><strong>差分適用失敗</strong> — ログに表示されるデバイス側のエラーメッセージを確認</li>
            <li><strong>バージョン不一致</strong> — NMOS API のバージョン（v1.2, v1.3 等）を正しく指定</li>
        </ul>
    </article>
</section>
            </main>
        </div>
    </div>
    <script src="../js/guide.js"></script>
</body>
</html>

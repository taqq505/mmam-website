<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="MMAM HOW TO USE - flow-hub">
    <title>MMAM Guide / flow-hub</title>
    <link rel="icon" type="image/svg+xml" href="../images/favicon.svg">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-100 text-slate-900 font-sans" data-guide-page="flow-hub">
    <div class="lg:flex">

<aside id="guide-sidebar" class="bg-slate-900 text-white w-72 min-h-screen flex flex-col fixed inset-y-0 left-0 z-40 transform transition-transform duration-200 lg:translate-x-0 -translate-x-full">
    <div class="px-6 py-5 border-b border-white/10 flex items-center gap-3">
        <svg width="40" height="40" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" class="flex-shrink-0">
            <rect x="4" y="4" width="56" height="56" rx="14" fill="#1e293b"/>
            <g fill="none" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="32" cy="28" r="8" stroke="#60a5fa" stroke-width="3"/>
                <path d="M20 44 A16 16 0 0 1 44 44" stroke="#3b82f6" stroke-width="3"/>
                <circle cx="20" cy="44" r="4" fill="#1e293b" stroke="#60a5fa" stroke-width="3"/>
                <circle cx="32" cy="44" r="4" fill="#1e293b" stroke="#60a5fa" stroke-width="3"/>
                <circle cx="44" cy="44" r="4" fill="#1e293b" stroke="#60a5fa" stroke-width="3"/>
            </g>
        </svg>
        <div>
            <p class="text-xs uppercase tracking-[0.3em] text-slate-300">HOW TO USE</p>
            <h1 class="text-xl font-semibold">MMAM Guide</h1>
        </div>
    </div>
    <nav class="flex-1 px-4 py-6 overflow-y-auto text-sm space-y-1">
        <a href="index.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="overview">概要</a>
        <a href="stack.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="stack">スタック構成</a>
        <a href="flows.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="flow-hub">フローとテキストハブ</a>
        <a href="planner.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="planner">Planner / Address Map</a>
        <a href="nmos.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="nmos">NMOS連携</a>
        <a href="checker.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="checker">Checker & 自動化</a>
        <a href="api.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="api">REST API / MQTT</a>
        <a href="setup.html" class="guide-link block px-3 py-2 rounded hover:bg-white/10 transition" data-guide-link="setup">セットアップ</a>
    </nav>
    <div class="px-4 py-4 border-t border-white/10 space-y-3 text-xs">
        <a href="../index.html" class="block bg-white/10 rounded px-3 py-2 text-center">Landingへ戻る</a>
        <div class="border border-dashed border-white/30 rounded-xl px-3 py-4 text-center text-slate-300">
            アフィリエイト枠（300x250）
        </div>
    </div>
</aside>

        <div class="flex-1 lg:ml-72 min-h-screen bg-slate-50">
            <header class="sticky top-0 z-30 bg-slate-50/95 backdrop-blur border-b border-slate-200 flex items-center justify-between px-4 py-3 lg:hidden">
                <button id="guide-sidebar-toggle" class="px-3 py-2 rounded border border-slate-300 text-sm font-medium">メニュー</button>
                <a href="../index.html" class="text-sm text-slate-500 underline">Landing</a>
            </header>
            <main class="px-6 py-10 max-w-5xl mx-auto space-y-12">

<section class="bg-gradient-to-r from-emerald-900 via-slate-900 to-emerald-800 rounded-3xl text-white p-8 shadow-xl border border-emerald-900 space-y-4">
    <div>
        <p class="text-xs uppercase tracking-[0.6em] text-white/60">flows</p>
        <h2 class="text-3xl font-semibold">フロー管理とテキストハブを極める</h2>
        <p class="text-white/80">UI初心者が迷わないクリック順と、プログラマー向けAPI仕様を1ページで俯瞰。Landingへのショートカットも常に表示します。</p>
    </div>
    <div class="flex flex-wrap gap-3">
        <a href="../index.html" class="px-4 py-2 rounded-full bg-white text-slate-900 font-semibold text-sm shadow">Landingへ戻る</a>
        <a href="https://github.com/taqq505/mmam-docker/blob/main/src/app/routers/flows.py" target="_blank" class="px-4 py-2 rounded-full border border-white/30 text-sm">flows API コード</a>
    </div>
</section>

<section class="bg-white rounded-2xl shadow-sm border border-slate-200 p-8 space-y-6">
    <h3 class="text-2xl font-semibold">UIの歩き方</h3>
    <ol class="list-decimal ml-5 text-slate-700 space-y-2">
        <li>左メニュー「Flows」を開き、上部の <strong>Quick Search</strong> でS/G/Portを即時フィルタ。初心者は <code>239.1.</code> のように一部入力してみる。</li>
        <li>右上の <strong>Manual Flow Entry</strong> を押すとフォームが開き、S/G/Port・冗長系・ラベル・テキストハブ欄が現れます。空欄には入力例のヒントが表示されます。</li>
        <li>編集中は <strong>Lock Flow</strong> を押して予約状態に。別ユーザーが上書きしようとすると HTTP 423 が返り、UIには「Locked by userX」と表示。</li>
    </ol>
    <p class="text-sm text-slate-500">UIでは保存前にバリデーション結果がリアルタイム表示されるため、Docker初心者でも安心して入力できます。</p>
</section>

<section class="grid md:grid-cols-2 gap-6">
    <article class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 space-y-3">
        <h3 class="text-xl font-semibold">テキストハブ設計のヒント</h3>
        <ul class="list-disc ml-5 text-slate-600 space-y-1">
            <li><code>alias_1</code>: BCC伝票番号 / <code>alias_2</code>: 制作タイトル</li>
            <li><code>user_field_1</code>: 監視担当コメント（MQTTで共有）</li>
            <li><code>user_field_5</code>: Slack / Teams のスレッドIDを保存し、相互リンクに活用</li>
        </ul>
        <p class="text-sm text-slate-500">各フィールドの用途は運用ルールとして Planner のノート欄や Confluence にメモしておくと迷いません。</p>
    </article>
    <article class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 space-y-3">
        <h3 class="text-xl font-semibold">REST API チートシート</h3>
        <pre class="bg-slate-900 text-white text-xs rounded-2xl p-4 overflow-x-auto"><code># 一覧
curl -H "Authorization: Bearer &lt;token&gt;" \
  'https://localhost:8443/flows?q=studio-a&amp;limit=50'

# 新規登録
curl -X POST https://localhost:8443/flows \
  -H "Content-Type: application/json" \
  -d '{ "flow_name": "Studio-A PRG", "src_ip": "239.1.1.10" }'

# テキストハブをPATCH
curl -X PATCH https://localhost:8443/flows/&lt;flow_id&gt; \
  -H "Content-Type: application/json" \
  -d '{ "alias_1": "B001-2024", "user_field_1": "Switch済み" }'</code></pre>
    </article>
</section>

<section class="bg-white rounded-2xl shadow-sm border border-slate-200 p-8 space-y-6">
    <h3 class="text-2xl font-semibold">データモデル要点</h3>
    <ul class="list-disc ml-5 text-slate-700 space-y-2">
        <li><code>flow_id (UUID)</code> — UI/REST/MQTT 全ての共通キー。既存システムとの連携もこのキーを保持すればOK。</li>
        <li><code>sdp_template</code> — IS-05から取り込んだパラメータをJSONで保持。NMOSページで詳しく説明。</li>
        <li><code>locked_by</code> と <code>locked_at</code> — Flow lock API で保護。UIは自動的に解放ボタンを表示。</li>
    </ul>
    <p class="text-sm text-slate-500">DBを直接触らずとも、REST PATCH でフィールドごとに更新できるため、簡単なワークフローはシェルスクリプトでも自動化できます。</p>
</section>

<section class="grid md:grid-cols-2 gap-6">
    <article class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 space-y-3">
        <h3 class="text-xl font-semibold">MQTTの通知例</h3>
        <p class="text-slate-600">Flowが更新されると以下のようなペイロードが publish されます。</p>
        <pre class="bg-slate-900 text-white text-xs rounded-2xl p-4 overflow-x-auto"><code>{
  "flow_id": "92c0-...",
  "event": "flow.updated",
  "changed_fields": ["alias_1", "user_field_1"],
  "updated_by": "admin",
  "timestamp": "2025-01-12T10:22:11Z"
}</code></pre>
        <p class="text-sm text-slate-500">番組進行アプリや簡易BOTがこれを購読することで、BCC情報を最新化できます。</p>
    </article>
    <article class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6 space-y-3">
        <h3 class="text-xl font-semibold">チェックリスト</h3>
        <ul class="list-disc ml-5 text-slate-600 space-y-1">
            <li>flowを削除する前に必ず Planner で予約ブロックを解放したか確認</li>
            <li>alias/userフィールドへ機密情報を書かない（MQTTで配信されるため）</li>
            <li>Automationで Flow Export をスケジュールし、Gitへ履歴管理するのも有効</li>
        </ul>
    </article>
</section>

<div class="border border-dashed border-slate-300 rounded-2xl px-4 py-8 text-center text-slate-500">テキストハブ連携（チャットボット等）の広告をここに配置できます</div>
            </main>
        </div>
    </div>
    <script src="../js/guide.js"></script>
</body>
</html>
